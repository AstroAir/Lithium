export default class RawDecoder{constructor(){this._lines=0}decodeRect(x,y,width,height,sock,display,depth){if(0===width||0===height)return!0;0===this._lines&&(this._lines=height);const pixelSize=8==depth?1:4,bytesPerLine=width*pixelSize;if(sock.rQwait("RAW",bytesPerLine))return!1;const curY=y+(height-this._lines),currHeight=Math.min(this._lines,Math.floor(sock.rQlen/bytesPerLine)),pixels=width*currHeight;let data=sock.rQ,index=sock.rQi;if(8==depth){const newdata=new Uint8Array(4*pixels);for(let i=0;i<pixels;i++)newdata[4*i+0]=255*(data[index+i]>>0&3)/3,newdata[4*i+1]=255*(data[index+i]>>2&3)/3,newdata[4*i+2]=255*(data[index+i]>>4&3)/3,newdata[4*i+3]=255;data=newdata,index=0}for(let i=0;i<pixels;i++)data[index+4*i+3]=255;return display.blitImage(x,curY,width,currHeight,data,index),sock.rQskipBytes(currHeight*bytesPerLine),this._lines-=currHeight,!(this._lines>0)}}